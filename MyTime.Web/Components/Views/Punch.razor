@using MyTime.Shifts
@using MyTime.Shifts.Contracts.Requests
@using MyTime.Shifts.Contracts.Responses
@inject IPunchService PunchService

@if (lastPunch is not null)
{
    <div>Last punch for user @UserId at @lastPunch.RecordedTime.ToLocalTime()</div>
}
<button @onclick="CreatePunch">Punch</button>

@if (createdPunch is not null)
{
    <div>Punched @(createdPunch.PunchType)!</div>
    <button @onclick="RemoveLastPunch">Undo</button>
}
@message

@code {
    [Parameter]
    public int UserId { get; set; }

    private PunchResponse? createdPunch;
    private PunchResponse? lastPunch;
    private string? message;

    protected override async Task OnParametersSetAsync()
    {
        await GetLastPunch();
    }

    private async Task GetLastPunch()
    {
        lastPunch = await PunchService.GetLastPunchForUserAsync(UserId); // todo: use real userid
    }
    private async Task CreatePunch()
    {
        CreatePunchRequest request = new(UserId);
        createdPunch = await PunchService.CreatePunchAsync(request);
        if (createdPunch is not null) lastPunch = createdPunch;
    }
    private async Task RemoveLastPunch()
    {
        var success = await PunchService.DeletePunchAsync(createdPunch.Id);
        if (success)
        {
            createdPunch = null;
            message = "Punch successfully removed!";
        }
        await GetLastPunch();
    }
}